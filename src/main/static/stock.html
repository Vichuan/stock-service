<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ST</title>
    <!-- <link rel="icon" type="image/x-icon" href="/images/xx.icon" /> -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
</head>

<body>
    <div id="app">
        <el-row style="width:45%;">
            <el-col :span="2.5">
                <div class="grid-content bg-purple">
                    开始时间：
                    <el-date-picker v-model="value1" type="date" value-format="yyyyMMdd" placeholder="选择日期">
                    </el-date-picker>
                </div>
            </el-col>
            <el-col :span="2.5">
                <div class="grid-content bg-purple-light">
                    开始时间：
                    <el-date-picker v-model="value2" type="date" value-format="yyyyMMdd" placeholder="选择日期">
                    </el-date-picker>
                </div>
            </el-col>
            <el-col :span="1">
                <div class="grid-content bg-purple">
                    <el-button type="primary" plain @click="query" v-loading.fullscreen.lock="fullscreenLoading">Query
                    </el-button>
                </div>
            </el-col>
        </el-row>

        <el-row>
            <div class="grid-content bg-purple-light">
                <div style="width:95%;">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </el-row>
    </div>

    <script type="text/javascript">
        // var urlPre = window.location.protocol + '//' + window.location.host;
        var urlPre = 'http://127.0.0.1:9999';
        var vm = new Vue({
            el: '#app',
            data: {
                stocks: [],
                value1: '',
                value2: '',
                fullscreenLoading: false
            },
            methods: {
                query: function () {
                    this.fullscreenLoading = true;
                    var startDate = this.value1;
                    var endDate = this.value2;
                    axios.get(urlPre + '/stock/queen-cycle?startDate=' + startDate + '&endDate=' + endDate).then(res => {
                        // this.stocks = res.data;
                        getStockTureover(res);
                        this.fullscreenLoading = false;
                    }).catch(error => {
                        this.fullscreenLoading = false;
                        this.$message.error(error.message);
                        console.log(error);
                    });
                },
            },
            created: function () {
                var timestamp = Date.parse(new Date()) - (10 * 24 * 60 * 60 * 1000);
                var date = new Date(timestamp);
                Y = date.getFullYear();
                M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1);
                D = date.getDate();
                this.value1 = Y + M + D;
            }
        });
        var c = document.getElementById('myChart');
        var ctx = null;
        if (c != null) {
            ctx = c.getContext('2d');
        }

        // function stockTureover(startDate, endDate) {
        //     axios.get(urlPre + '/stock/queen-cycle?startDate=' + startDate + '&endDate=' + endDate).then(res => {
        //         getStockTureover(res);
        //     }).catch(error => {
        //         console.log(error);
        //     });
        // }

        function getStockTureover(res) {
            var labels = [];
            var data1 = [];
            var data2 = [];
            var data3 = [];
            var data4 = [];
            var stData = res.data.data;
            for (var i = 0; i < stData.length; i++) {
                console.log(stData[i]);
                labels.push(stData[i].tradeDate)
                data1.push(stData[i].limitUpCount)
                data2.push(stData[i].continuousLimit)
                data3.push(stData[i].highestLimit)
                data4.push(stData[i].limitDownCount)
            }

            var data = {
                labels: labels,
                datasets: [
                    {
                        label: "Queen Mood Cycle",
                        fillColor: "rgba(220,220,220,0.2)",
                        strokeColor: "rgba(220,220,220,1)",
                        pointColor: "rgba(220,220,220,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(120,220,220,1)",
                        data: data1
                    },
                    {
                        label: "Price",
                        fillColor: "rgba(151,187,205,0.2)",
                        strokeColor: "rgba(151,187,205,1)",
                        pointColor: "rgba(151,187,205,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(151,187,205,1)",
                        data: data2
                    },
                    {
                        label: "Price1",
                        fillColor: "rgba(151,2,205,0.2)",
                        strokeColor: "rgba(151,2,205,1)",
                        pointColor: "rgba(151,2,205,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(151,2,205,1)",
                        data: data3
                    },
                    {
                        label: "Price2",
                        fillColor: "rgba(2,187,205,0.2)",
                        strokeColor: "rgba(2,187,205,1)",
                        pointColor: "rgba(2,187,205,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(2,187,205,1)",
                        data: data4
                    }
                ]
            };
            var myChart = new Chart(ctx, {
                type: 'line',
                data: data
            });
        }
        function formatDate(timestamp) {
            var now = new Date(timestamp);
            var year = now.getFullYear();
            var month = now.getMonth() + 1;
            var date = now.getDate();
            var hour = now.getHours();
            var minute = now.getMinutes();
            var second = now.getSeconds();
            return year + '' + month + '' + date;
        } 
    </script>
    <style>
        .el-row {
            margin-bottom: 20px;

            &:last-child {
                margin-bottom: 0;
            }
        }

        .el-col {
            border-radius: 40px;
        }

        .bg-purple {
            background: #d3dce6;
        }

        .bg-purple-light {
            background: #e5e9f2;
        }

        .grid-content {
            border-radius: 4px;
            min-height: 36px;
        }

        .small {
            width: 500px;
            height: 500px;
        }
    </style>
</body>

</html>